#ifndef CROSSFADE3_LIB
#define CROSSFADE3_SINE 0
#define CROSSFADE3_EXP 1
#define CROSSFADE3_LOG 2

static int32_t crossfade3_sine[441] = {
    65536, 65535, 65532, 65528, 65522, 65515, 65505, 65495, 65482, 65468, 65452,
    65434, 65415, 65394, 65372, 65348, 65322, 65294, 65265, 65234, 65202, 65168,
    65132, 65095, 65056, 65015, 64972, 64928, 64883, 64836, 64787, 64736, 64684,
    64630, 64575, 64518, 64459, 64399, 64337, 64273, 64208, 64141, 64073, 64003,
    63932, 63859, 63784, 63708, 63630, 63550, 63469, 63387, 63303, 63217, 63130,
    63041, 62951, 62859, 62766, 62671, 62574, 62476, 62377, 62276, 62173, 62069,
    61964, 61857, 61749, 61639, 61527, 61414, 61300, 61184, 61067, 60948, 60828,
    60707, 60584, 60459, 60334, 60207, 60078, 59948, 59817, 59684, 59550, 59414,
    59277, 59139, 59000, 58859, 58717, 58573, 58428, 58282, 58135, 57986, 57836,
    57684, 57532, 57378, 57223, 57067, 56909, 56750, 56590, 56429, 56266, 56103,
    55938, 55772, 55605, 55436, 55267, 55096, 54924, 54751, 54577, 54402, 54226,
    54049, 53870, 53691, 53510, 53328, 53146, 52962, 52777, 52591, 52405, 52217,
    52028, 51838, 51648, 51456, 51263, 51070, 50875, 50680, 50483, 50286, 50088,
    49889, 49689, 49488, 49286, 49084, 48881, 48676, 48472, 48266, 48059, 47852,
    47644, 47435, 47225, 47015, 46804, 46592, 46380, 46167, 45953, 45738, 45523,
    45307, 45091, 44874, 44656, 44438, 44219, 43999, 43779, 43559, 43337, 43116,
    42893, 42671, 42447, 42224, 41999, 41775, 41549, 41324, 41098, 40871, 40644,
    40417, 40189, 39961, 39733, 39504, 39275, 39045, 38816, 38586, 38355, 38124,
    37894, 37662, 37431, 37199, 36967, 36735, 36503, 36270, 36038, 35805, 35572,
    35338, 35105, 34872, 34638, 34405, 34171, 33937, 33703, 33469, 33235, 33001,
    32768, 32534, 32300, 32066, 31832, 31598, 31364, 31130, 30897, 30663, 30430,
    30197, 29963, 29730, 29497, 29265, 29032, 28800, 28568, 28336, 28104, 27873,
    27641, 27411, 27180, 26949, 26719, 26490, 26260, 26031, 25802, 25574, 25346,
    25118, 24891, 24664, 24437, 24211, 23986, 23760, 23536, 23311, 23088, 22864,
    22642, 22419, 22198, 21976, 21756, 21536, 21316, 21097, 20879, 20661, 20444,
    20228, 20012, 19797, 19582, 19368, 19155, 18943, 18731, 18520, 18310, 18100,
    17891, 17683, 17476, 17269, 17063, 16859, 16654, 16451, 16249, 16047, 15846,
    15646, 15447, 15249, 15052, 14855, 14660, 14465, 14272, 14079, 13887, 13697,
    13507, 13318, 13130, 12944, 12758, 12573, 12389, 12207, 12025, 11844, 11665,
    11486, 11309, 11133, 10958, 10784, 10611, 10439, 10268, 10099, 9930,  9763,
    9597,  9432,  9269,  9106,  8945,  8785,  8626,  8468,  8312,  8157,  8003,
    7851,  7699,  7549,  7400,  7253,  7107,  6962,  6818,  6676,  6535,  6396,
    6258,  6121,  5985,  5851,  5718,  5587,  5457,  5328,  5201,  5076,  4951,
    4828,  4707,  4587,  4468,  4351,  4235,  4121,  4008,  3896,  3786,  3678,
    3571,  3466,  3362,  3259,  3158,  3059,  2961,  2864,  2769,  2676,  2584,
    2494,  2405,  2318,  2232,  2148,  2066,  1985,  1905,  1827,  1751,  1676,
    1603,  1532,  1462,  1394,  1327,  1262,  1198,  1136,  1076,  1017,  960,
    905,   851,   799,   748,   699,   652,   607,   563,   520,   479,   440,
    403,   367,   333,   301,   270,   241,   213,   187,   163,   141,   120,
    101,   83,    67,    53,    40,    30,    20,    13,    7,     3,     0,
    0,
};
static int32_t crossfade3_exp[441] = {
    65536, 64736, 63946, 63166, 62396, 61635, 60883, 60140, 59407, 58682, 57966,
    57259, 56561, 55871, 55189, 54516, 53851, 53194, 52546, 51905, 51272, 50646,
    50028, 49418, 48815, 48220, 47632, 47051, 46477, 45910, 45350, 44797, 44250,
    43710, 43177, 42651, 42130, 41616, 41109, 40607, 40112, 39623, 39140, 38662,
    38190, 37725, 37264, 36810, 36361, 35917, 35479, 35047, 34619, 34197, 33780,
    33368, 32961, 32559, 32161, 31769, 31382, 30999, 30621, 30247, 29878, 29514,
    29154, 28798, 28447, 28100, 27757, 27418, 27084, 26754, 26427, 26105, 25787,
    25472, 25161, 24854, 24551, 24252, 23956, 23664, 23375, 23090, 22808, 22530,
    22255, 21984, 21716, 21451, 21189, 20931, 20675, 20423, 20174, 19928, 19685,
    19445, 19208, 18973, 18742, 18513, 18287, 18064, 17844, 17626, 17411, 17199,
    16989, 16782, 16577, 16375, 16175, 15978, 15783, 15590, 15400, 15212, 15027,
    14844, 14662, 14484, 14307, 14132, 13960, 13790, 13622, 13455, 13291, 13129,
    12969, 12811, 12655, 12500, 12348, 12197, 12048, 11901, 11756, 11613, 11471,
    11331, 11193, 11056, 10922, 10788, 10657, 10527, 10398, 10271, 10146, 10022,
    9900,  9779,  9660,  9542,  9426,  9311,  9197,  9085,  8974,  8865,  8757,
    8650,  8544,  8440,  8337,  8235,  8135,  8036,  7938,  7841,  7745,  7651,
    7557,  7465,  7374,  7284,  7195,  7108,  7021,  6935,  6851,  6767,  6685,
    6603,  6522,  6443,  6364,  6287,  6210,  6134,  6059,  5985,  5912,  5840,
    5769,  5699,  5629,  5561,  5493,  5426,  5359,  5294,  5230,  5166,  5103,
    5040,  4979,  4918,  4858,  4799,  4740,  4683,  4625,  4569,  4513,  4458,
    4404,  4350,  4297,  4245,  4193,  4142,  4091,  4041,  3992,  3943,  3895,
    3848,  3801,  3754,  3709,  3663,  3619,  3574,  3531,  3488,  3445,  3403,
    3362,  3321,  3280,  3240,  3201,  3162,  3123,  3085,  3047,  3010,  2973,
    2937,  2901,  2866,  2831,  2796,  2762,  2729,  2695,  2662,  2630,  2598,
    2566,  2535,  2504,  2473,  2443,  2413,  2384,  2355,  2326,  2298,  2270,
    2242,  2215,  2188,  2161,  2135,  2109,  2083,  2057,  2032,  2008,  1983,
    1959,  1935,  1911,  1888,  1865,  1842,  1820,  1798,  1776,  1754,  1733,
    1711,  1691,  1670,  1650,  1629,  1610,  1590,  1570,  1551,  1532,  1514,
    1495,  1477,  1459,  1441,  1424,  1406,  1389,  1372,  1355,  1339,  1322,
    1306,  1290,  1275,  1259,  1244,  1229,  1214,  1199,  1184,  1170,  1155,
    1141,  1127,  1114,  1100,  1087,  1073,  1060,  1047,  1035,  1022,  1009,
    997,   985,   973,   961,   949,   938,   926,   915,   904,   893,   882,
    871,   860,   850,   840,   829,   819,   809,   799,   790,   780,   770,
    761,   752,   743,   734,   725,   716,   707,   698,   690,   681,   673,
    665,   657,   649,   641,   633,   625,   618,   610,   603,   595,   588,
    581,   574,   567,   560,   553,   546,   540,   533,   526,   520,   514,
    507,   501,   495,   489,   483,   477,   471,   466,   460,   454,   449,
    443,   438,   433,   427,   422,   417,   412,   407,   402,   397,   392,
    387,   383,   378,   373,   369,   364,   360,   355,   351,   347,   342,
    338,   334,   330,   326,   322,   318,   314,   310,   307,   303,   299,
    295,
};
static int32_t crossfade3_log[441] = {
    65536, 65283, 65031, 64780, 64530, 64282, 64034, 63787, 63541, 63295, 63051,
    62808, 62565, 62324, 62083, 61843, 61604, 61366, 61129, 60893, 60657, 60423,
    60189, 59956, 59724, 59493, 59262, 59032, 58804, 58576, 58348, 58122, 57896,
    57671, 57447, 57223, 57001, 56779, 56558, 56337, 56118, 55899, 55680, 55463,
    55246, 55030, 54815, 54600, 54386, 54173, 53960, 53748, 53537, 53327, 53117,
    52908, 52699, 52491, 52284, 52078, 51872, 51667, 51462, 51258, 51055, 50852,
    50650, 50448, 50248, 50047, 49848, 49649, 49450, 49253, 49055, 48859, 48663,
    48467, 48272, 48078, 47884, 47691, 47499, 47307, 47115, 46924, 46734, 46544,
    46355, 46166, 45978, 45791, 45604, 45417, 45231, 45046, 44861, 44676, 44492,
    44309, 44126, 43944, 43762, 43580, 43399, 43219, 43039, 42860, 42681, 42502,
    42324, 42147, 41970, 41794, 41618, 41442, 41267, 41092, 40918, 40744, 40571,
    40398, 40226, 40054, 39883, 39712, 39541, 39371, 39202, 39032, 38864, 38695,
    38527, 38360, 38193, 38026, 37860, 37694, 37529, 37364, 37200, 37035, 36872,
    36708, 36546, 36383, 36221, 36059, 35898, 35737, 35577, 35416, 35257, 35097,
    34938, 34780, 34622, 34464, 34307, 34149, 33993, 33837, 33681, 33525, 33370,
    33215, 33061, 32907, 32753, 32599, 32446, 32294, 32141, 31990, 31838, 31687,
    31536, 31385, 31235, 31085, 30936, 30787, 30638, 30489, 30341, 30193, 30046,
    29899, 29752, 29605, 29459, 29313, 29168, 29022, 28878, 28733, 28589, 28445,
    28301, 28158, 28015, 27872, 27730, 27588, 27446, 27305, 27163, 27023, 26882,
    26742, 26602, 26462, 26323, 26184, 26045, 25907, 25768, 25631, 25493, 25356,
    25219, 25082, 24946, 24809, 24673, 24538, 24403, 24268, 24133, 23998, 23864,
    23730, 23597, 23463, 23330, 23197, 23065, 22932, 22800, 22668, 22537, 22406,
    22275, 22144, 22014, 21883, 21753, 21624, 21494, 21365, 21236, 21107, 20979,
    20851, 20723, 20595, 20468, 20341, 20214, 20087, 19961, 19834, 19708, 19583,
    19457, 19332, 19207, 19082, 18958, 18834, 18709, 18586, 18462, 18339, 18216,
    18093, 17970, 17848, 17725, 17604, 17482, 17360, 17239, 17118, 16997, 16876,
    16756, 16636, 16516, 16396, 16277, 16157, 16038, 15919, 15801, 15682, 15564,
    15446, 15328, 15211, 15093, 14976, 14859, 14742, 14626, 14510, 14393, 14277,
    14162, 14046, 13931, 13816, 13701, 13586, 13472, 13357, 13243, 13129, 13016,
    12902, 12789, 12676, 12563, 12450, 12337, 12225, 12113, 12001, 11889, 11778,
    11666, 11555, 11444, 11333, 11223, 11112, 11002, 10892, 10782, 10672, 10563,
    10453, 10344, 10235, 10126, 10018, 9909,  9801,  9693,  9585,  9477,  9370,
    9262,  9155,  9048,  8941,  8834,  8728,  8622,  8515,  8409,  8304,  8198,
    8093,  7987,  7882,  7777,  7672,  7568,  7463,  7359,  7255,  7151,  7047,
    6943,  6840,  6737,  6633,  6530,  6428,  6325,  6222,  6120,  6018,  5916,
    5814,  5712,  5611,  5509,  5408,  5307,  5206,  5105,  5005,  4904,  4804,
    4704,  4604,  4504,  4404,  4305,  4205,  4106,  4007,  3908,  3809,  3710,
    3612,  3514,  3415,  3317,  3219,  3122,  3024,  2927,  2829,  2732,  2635,
    2538,  2441,  2345,  2248,  2152,  2056,  1960,  1864,  1768,  1672,  1577,
    1482,  1386,  1291,  1196,  1102,  1007,  912,   818,   724,   630,   536,
    442,
};

int16_t crossfade3_in(int16_t val, uint16_t i, uint8_t crossfade_type) {
  if (crossfade_type == CROSSFADE3_SINE) {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), crossfade3_sine[i]));
  } else if (crossfade_type == CROSSFADE3_EXP) {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), crossfade3_exp[i]));
  } else {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), crossfade3_log[i]));
  }
}
int16_t crossfade3_out(int16_t val, uint16_t i, uint8_t crossfade_type) {
  if (crossfade_type == CROSSFADE3_SINE) {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), 65536 - crossfade3_sine[i]));
  } else if (crossfade_type == CROSSFADE3_EXP) {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), 65536 - crossfade3_exp[i]));
  } else {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), 65536 - crossfade3_log[i]));
  }
}
#define CROSSFADE3_LIB 1
#endif
